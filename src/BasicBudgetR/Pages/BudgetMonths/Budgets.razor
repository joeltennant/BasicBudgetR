@page "/budgets"
@using BasicBudgetR.Core.Models;
@using BasicBudgetR.Server.Application.Handlers.BudgetMonths;
@inject ISnackbar Snackbar

<MudGrid>
    <MudItem xs="12">
        <MudPaper Elevation="25" Style="@($"color:{Colors.Shades.White};background-color:{Colors.Purple.Darken4}")">
            <MudToolBar>
                <MudText Typo="Typo.h5" Class="pr-3">Budgets</MudText>
                @* <MudIconButton Icon="@Icons.Material.Outlined.Edit" /> *@
                @* <MudIconButton Icon="@Icons.Material.Outlined.Remove" Color="Color.Inherit" /> *@
                <MudSpacer />
            </MudToolBar>
        </MudPaper>
    </MudItem>
    <MudItem xs="6">
        <MudTable Items="@BudgetMonthModels" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@_loading" LoadingProgressColor="Color.Info">
            <HeaderContent>
                <MudTh>Month</MudTh>
                <MudTh>Year</MudTh>
                <MudTh>Income Total</MudTh>
                <MudTh>Expense Total</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Month">@context.MonthName</MudTd>
                <MudTd DataLabel="Year">@context.Year</MudTd>
                <MudTd DataLabel="Income Total">@context.IncomeTotal</MudTd>
                <MudTd DataLabel="Expense Total">@context.ExpenseTotal</MudTd>
            </RowTemplate>
        </MudTable>
    </MudItem>
</MudGrid>

@code {
    private IEnumerable<BudgetMonthModel> BudgetMonthModels = new List<BudgetMonthModel>();
    private bool _loading;


    protected override async Task OnInitializedAsync()
    {
        await GetBudgets();
    }

    private async Task GetBudgets()
    {
        _loading = true;
        var result = await _mediator.Send(new AllBudgets.Request());

        if (result.IsSuccess)
        {
            BudgetMonthModels = result.Value;
        }
        else
        {
            Snackbar.Add("Your budgets cannot be loaded at this time.", Severity.Error);
        }
        _loading = false;
    }
}
